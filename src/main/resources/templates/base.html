<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	th:fragment="layout(content)">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SolarTech India - Solar Power Solutions</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" th:href="@{/css/solar-theme.css}">
<link rel="stylesheet" th:href="@{/css/animations.css}">
<link rel="stylesheet" th:href="@{/css/page-styles.css}">
<link rel="stylesheet" th:href="@{/css/calculator-style.css}">

<style>
    .preloader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--background-light);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: opacity 0.5s ease;
    }
    
    .preloader.fade-out {
        opacity: 0;
        pointer-events: none;
    }
    
    .navbar {
        transition: transform 0.3s ease, background-color 0.3s ease;
    }
    
    .navbar.scrolled {
        background: rgba(37, 99, 235, 0.95) !important;
        backdrop-filter: blur(10px);
    }
    
    .gradient-text {
        background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        display: inline-block;
    }

    body {
        padding-top: 76px;
        background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
    }

    /* Unified product container styling */
    .product-container {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        margin-bottom: 2rem;
        transition: all 0.3s ease;
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .product-container:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    
    .product-container .product-img {
        height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        overflow: hidden;
    }
    
    .product-container .product-img img {
        max-height: 100%;
        max-width: 100%;
        object-fit: contain;
        transition: all 0.3s ease;
    }
    
    .product-container:hover .product-img img {
        transform: scale(1.05);
    }
    
    .product-container .product-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        text-align: center;
        height: 3rem;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }
    
    .product-container .product-price {
        font-size: 1.2rem;
        color: var(--primary-color);
        font-weight: 700;
        text-align: center;
        margin-bottom: 0.75rem;
    }
    
    .product-container .product-discount {
        color: #138808;
        font-size: 0.9rem;
        margin-left: 0.5rem;
    }
    
    .product-container .product-action {
        margin-top: auto;
    }
    
    /* India accent styling */
    .india-accent {
        background: linear-gradient(to right, #FF9933, #FFFFFF, #138808);
        height: 3px;
        width: 100%;
        margin: 8px 0;
    }
    
    /* Fix for calculator */
    .calculator-container {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        padding: 2rem;
        margin-bottom: 2rem;
    }
    
    .calculator-input {
        margin-bottom: 1.5rem;
    }
    
    .calculator-result {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: #fff;
        padding: 1.5rem;
        border-radius: 10px;
        margin-top: 1.5rem;
    }
    
    .calculator-result h4 {
        margin-bottom: 1rem;
        font-weight: 600;
    }
    
    /* Fix for mobile responsiveness */
    @media (max-width: 768px) {
        .product-container {
            max-width: 320px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .product-container .product-img {
            height: 180px;
        }
        
        .product-container .product-title {
            height: auto;
            max-height: 3.5rem;
        }
    }
</style>
</head>
<body>
    <!-- Preloader -->
    <div class="preloader">
        <div class="loading-spinner"></div>
    </div>

    <!-- Scroll Progress -->
    <div class="scroll-progress"></div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-solar-panel me-2"></i>
                <span class="gradient-text">SolarTech India</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <th:block th:if="${user==null}">
                        <li class="nav-item">
                            <a class="nav-link" href="/">
                                <i class="fas fa-home me-1"></i> Home
                            </a>
                        </li>
                    </th:block>

                    <th:block th:unless="${user==null}">
                        <li class="nav-item" th:if="${user.role=='ROLE_ADMIN'}">
                            <a class="nav-link" href="/admin/">
                                <i class="fas fa-home me-1"></i> Home
                            </a>
                        </li>

                        <li class="nav-item" th:if="${user.role=='ROLE_USER'}">
                            <a class="nav-link" href="/">
                                <i class="fas fa-home me-1"></i> Home
                            </a>
                        </li>
                    </th:block>

                    <li class="nav-item">
                        <a class="nav-link" href="/products">
                            <i class="fas fa-shopping-bag me-1"></i> Products
                        </a>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-th-large me-1"></i> Solutions
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/solutions"><i class="fas fa-solar-panel me-2"></i>All Solar Solutions</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{'/products?category=Residential'}"><i class="fas fa-home me-2"></i>Residential</a></li>
                            <li><a class="dropdown-item" th:href="@{'/products?category=Commercial'}"><i class="fas fa-building me-2"></i>Commercial</a></li>
                            <li><a class="dropdown-item" th:href="@{'/products?category=Industrial'}"><i class="fas fa-industry me-2"></i>Industrial</a></li>
                            <li><a class="dropdown-item" th:href="@{'/products?category=Agricultural'}"><i class="fas fa-tractor me-2"></i>Agricultural</a></li>
                            <li><a class="dropdown-item" th:href="@{'/products?category=Off-Grid'}"><i class="fas fa-map-marked-alt me-2"></i>Off-Grid</a></li>
                            <li><a class="dropdown-item" th:href="@{'/products?category=Smart Home'}"><i class="fas fa-microchip me-2"></i>Smart Home</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li th:each="c:${categorys}">
                                <a class="dropdown-item" th:href="@{'/products?category='+${c.name}}">
                                    <i class="fas fa-chevron-right me-2"></i>[[${c.name}]]
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-book me-1"></i> Resources
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/resources"><i class="fas fa-file-alt me-2"></i>All Resources</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/blog"><i class="fas fa-newspaper me-2"></i>Blog</a></li>
                            <li><a class="dropdown-item" href="/how-it-works"><i class="fas fa-lightbulb me-2"></i>How Solar Works</a></li>
                            <li><a class="dropdown-item" href="/solar-financing"><i class="fas fa-money-bill-wave me-2"></i>Subsidy & Financing</a></li>
                            <li><a class="dropdown-item" href="/faq"><i class="fas fa-question-circle me-2"></i>FAQ</a></li>
                        </ul>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/calculator">
                            <i class="fas fa-calculator me-1"></i> Solar Calculator
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="/testimonials">
                            <i class="fas fa-star me-1"></i> Success Stories
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/contact">
                            <i class="fas fa-envelope me-1"></i> Contact
                        </a>
                    </li>
                </ul>

                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <th:block th:if="${user==null}">
                        <li class="nav-item">
                            <a class="nav-link btn-solar me-2" href="/signin">
                                <i class="fas fa-sign-in-alt me-1"></i> Login
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn-solar" href="/register">
                                <i class="fas fa-user-plus me-1"></i> Register
                            </a>
                        </li>
                    </th:block>

                    <th:block th:if="${user!=null}">
                        <th:block th:if="${user.role=='ROLE_USER'}">
                            <li class="nav-item">
                                <a class="nav-link cart-badge" href="/user/cart">
                                    <i class="fas fa-shopping-cart me-1"></i> Cart
                                    <span class="badge" th:text="${countCart}">0</span>
                                </a>
                            </li>
                        </th:block>
                        <li class="nav-item dropdown user-menu">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user me-1"></i> [[${user.name}]]
                            </a>
                            <ul class="dropdown-menu">
                                <li th:if="${user.role=='ROLE_USER'}">
                                    <a class="dropdown-item" href="/user/profile">
                                        <i class="fas fa-id-card me-2"></i> Profile
                                    </a>
                                </li>
                                <li th:if="${user.role=='ROLE_ADMIN'}">
                                    <a class="dropdown-item" href="/admin/profile">
                                        <i class="fas fa-id-card me-2"></i> Profile
                                    </a>
                                </li>
                                <li th:if="${user.role=='ROLE_USER'}">
                                    <a class="dropdown-item" href="/user/user-orders">
                                        <i class="fas fa-box me-2"></i> My Orders
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="/logout">
                                        <i class="fas fa-sign-out-alt me-2"></i> Logout
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </th:block>
                </ul>
            </div>
        </div>
    </nav>

    <div th:replace="${content}"></div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4 reveal-left">
                    <h5 class="gradient-text">About SolarTech India</h5>
                    <div class="india-accent"></div>
                    <p>Leading provider of solar energy solutions across India. Committed to powering the nation with clean, renewable energy for a sustainable future.</p>
                </div>
                <div class="col-md-4 reveal">
                    <h5 class="gradient-text">Quick Links</h5>
                    <div class="india-accent"></div>
                    <ul>
                        <li><a href="/products" class="hover-float"><i class="fas fa-chevron-right me-2"></i>Products</a></li>
                        <li><a href="/solutions" class="hover-float"><i class="fas fa-chevron-right me-2"></i>Solutions</a></li>
                        <li><a href="/solar-financing" class="hover-float"><i class="fas fa-chevron-right me-2"></i>Govt. Subsidies</a></li>
                        <li><a href="/contact" class="hover-float"><i class="fas fa-chevron-right me-2"></i>Contact</a></li>
                        <li><a href="/register" class="hover-float"><i class="fas fa-chevron-right me-2"></i>Register</a></li>
                    </ul>
                </div>
                <div class="col-md-4 reveal-right">
                    <h5 class="gradient-text">Contact Us</h5>
                    <div class="india-accent"></div>
                    <ul>
                        <li class="hover-float"><i class="fas fa-phone me-2"></i>+91 9876 543 210</li>
                        <li class="hover-float"><i class="fas fa-envelope me-2"></i>info@solartechindia.com</li>
                        <li class="hover-float"><i class="fas fa-map-marker-alt me-2"></i>123 Green Energy Road, Bengaluru 560001</li>
                        <li class="hover-float"><i class="fas fa-building me-2"></i>Branch Offices: Delhi, Mumbai, Chennai, Hyderabad</li>
                        <li class="hover-float"><i class="fas fa-clock me-2"></i>Mon-Sat: 9:00 AM - 6:00 PM</li>
                    </ul>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-12 text-center reveal-bottom">
                    <div class="india-accent"></div>
                    <p class="mb-0">&copy; 2024 SolarTech India. All rights reserved. GST: 27AABCS1234A1Z5</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/animations.js"></script>
    <script src="/js/calculator-animations.js"></script>
    <script src="/js/product-page.js"></script>
    
    <script>
        // Preloader
        window.addEventListener('load', function() {
            const preloader = document.querySelector('.preloader');
            preloader.classList.add('fade-out');
            
            // Add loaded class to document to prevent FOUC
            document.documentElement.classList.add('js-loaded');
            
            // Add loaded class to images that have already completed loading
            document.querySelectorAll('img').forEach(img => {
                if (img.complete) {
                    img.classList.add('loaded');
                } else {
                    img.addEventListener('load', function() {
                        img.classList.add('loaded');
                    });
                }
            });
        });

        // Scroll Progress
        let scrollTicking = false;
        window.addEventListener('scroll', function() {
            if (!scrollTicking) {
                window.requestAnimationFrame(function() {
                    const scrollProgress = document.querySelector('.scroll-progress');
                    const scrollPercent = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
                    scrollProgress.style.transform = `scaleX(${scrollPercent / 100})`;
                    scrollTicking = false;
                });
                scrollTicking = true;
            }
        });

        // Reveal Animations with performance optimization
        const revealElements = document.querySelectorAll('.reveal, .reveal-left, .reveal-right, .reveal-bottom');
        let revealTicking = false;
        
        function checkReveal() {
            if (!revealTicking) {
                window.requestAnimationFrame(function() {
                    revealElements.forEach(element => {
                        const elementTop = element.getBoundingClientRect().top;
                        const windowHeight = window.innerHeight;
                        
                        if (elementTop < windowHeight - 100) {
                            element.classList.add('active');
                        }
                    });
                    revealTicking = false;
                });
                revealTicking = true;
            }
        }

        window.addEventListener('scroll', checkReveal);
        window.addEventListener('load', checkReveal);

        // Navbar scroll effect with performance optimization
        let navbarTicking = false;
        window.addEventListener('scroll', function() {
            if (!navbarTicking) {
                window.requestAnimationFrame(function() {
                    const navbar = document.querySelector('.navbar');
                    if (window.scrollY > 50) {
                        navbar.classList.add('scrolled');
                    } else {
                        navbar.classList.remove('scrolled');
                    }
                    navbarTicking = false;
                });
                navbarTicking = true;
            }
        });
        
        // Format currency as INR
        function formatINR(amount) {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                maximumFractionDigits: 0
            }).format(amount);
        }
        
        // Apply INR formatting to any elements with class 'inr-format'
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.inr-format').forEach(el => {
                const amount = parseFloat(el.textContent.replace(/[^\d.-]/g, ''));
                if (!isNaN(amount)) {
                    el.textContent = formatINR(amount);
                }
            });
            
            // Fix for Solar Calculator
            setupSolarCalculator();
        });
        
        // Solar Calculator Functionality
        function setupSolarCalculator() {
            const calculatorForm = document.getElementById('solarCalculatorForm');
            if (calculatorForm) {
                calculatorForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Get input values
                    const electricityBill = parseFloat(document.getElementById('monthlyBill').value) || 0;
                    const roofArea = parseFloat(document.getElementById('roofArea').value) || 0;
                    const sunlightHours = parseFloat(document.getElementById('sunlightHours').value) || 0;
                    
                    // Basic calculations
                    let monthlyConsumption = electricityBill / 7; // Assuming ₹7 per kWh average in India
                    let systemSizeKW = Math.min(monthlyConsumption / (30 * sunlightHours * 0.8), roofArea / 10);
                    let systemSizeRounded = Math.round(systemSizeKW * 100) / 100;
                    let annualGeneration = systemSizeKW * 365 * sunlightHours * 0.8;
                    let savings = annualGeneration * 7; // Yearly savings in Rupees
                    let installationCost = systemSizeKW * 60000; // Approximate cost in INR
                    let subsidyAmount = (systemSizeKW <= 3) ? installationCost * 0.4 : 
                                        (systemSizeKW <= 10) ? installationCost * 0.2 : 0;
                    let finalCost = installationCost - subsidyAmount;
                    let roi = finalCost / savings; // Years to recover investment
                                
                    // Display results
                    const resultsDiv = document.getElementById('calculatorResults');
                    if (resultsDiv) {
                        resultsDiv.innerHTML = `
                            <h4 class="mb-3 text-center">Solar System Recommendation</h4>
                            <div class="india-accent mb-3 mx-auto" style="max-width: 100px;"></div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="result-card p-3 rounded bg-light">
                                        <h5><i class="fas fa-solar-panel me-2 text-primary"></i>System Size</h5>
                                        <p class="fs-4 fw-bold">${systemSizeRounded} kW</p>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="result-card p-3 rounded bg-light">
                                        <h5><i class="fas fa-bolt me-2 text-warning"></i>Annual Generation</h5>
                                        <p class="fs-4 fw-bold">${Math.round(annualGeneration)} kWh</p>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="result-card p-3 rounded bg-light">
                                        <h5><i class="fas fa-rupee-sign me-2 text-success"></i>Yearly Savings</h5>
                                        <p class="fs-4 fw-bold">${formatINR(Math.round(savings))}</p>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="result-card p-3 rounded bg-light">
                                        <h5><i class="fas fa-calendar-alt me-2 text-danger"></i>Payback Period</h5>
                                        <p class="fs-4 fw-bold">${Math.round(roi * 10) / 10} years</p>
                                    </div>
                                </div>
                            </div>
                            <div class="subsidy-info alert alert-info mt-3">
                                <h5><i class="fas fa-hand-holding-usd me-2"></i>Government Subsidy</h5>
                                <p>Estimated subsidy amount: <strong>${formatINR(Math.round(subsidyAmount))}</strong></p>
                                <p>Final installation cost after subsidy: <strong>${formatINR(Math.round(finalCost))}</strong></p>
                                <small>Note: Subsidy rates may vary based on your state and current government policies.</small>
                            </div>
                            <div class="text-center mt-4">
                                <a href="/products" class="btn btn-primary btn-lg">
                                    <i class="fas fa-shopping-cart me-2"></i>Explore Solar Products
                                </a>
                            </div>
                        `;
                        
                        // Show results with smooth animation
                        resultsDiv.style.display = 'block';
                        resultsDiv.style.opacity = '0';
                        resultsDiv.style.transform = 'translateY(20px)';
                        setTimeout(() => {
                            resultsDiv.style.transition = 'all 0.5s ease';
                            resultsDiv.style.opacity = '1';
                            resultsDiv.style.transform = 'translateY(0)';
                        }, 100);
                        
                        // Scroll to results
                        resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            }
            
            // Fix for product container display
            standardizeProductContainers();
        }
        
        // Standardize all product containers to have consistent styling
        function standardizeProductContainers() {
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                if (!card.classList.contains('standardized')) {
                    card.classList.add('standardized', 'product-container');
                    
                    // Make sure all images have proper dimensions
                    const img = card.querySelector('img');
                    if (img) {
                        const imgWrapper = document.createElement('div');
                        imgWrapper.classList.add('product-img');
                        img.parentNode.insertBefore(imgWrapper, img);
                        imgWrapper.appendChild(img);
                    }
                    
                    // Make sure all titles have consistent styling
                    const title = card.querySelector('.card-title');
                    if (title) {
                        title.classList.add('product-title');
                    }
                    
                    // Make sure all price elements have consistent styling
                    const priceEl = card.querySelector('.current-price');
                    if (priceEl) {
                        priceEl.classList.add('product-price');
                    }
                }
            });
        }
    </script>
</body>
</html>